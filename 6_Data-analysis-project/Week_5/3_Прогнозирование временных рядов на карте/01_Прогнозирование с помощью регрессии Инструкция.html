<meta charset="utf-8"/>
<co-content>
 <p>
  Класс моделей ARIMA недостаточно богат для наших данных: с их помощью, например, никак нельзя учесть взаимосвязи между рядами. Это можно сделать с помощью векторной авторегрессии VARIMA, но её питоновская реализация не позволяет использовать регрессионные признаки. Кроме того, авторегрессионный подход не позволяет учитывать, например, взаимодействия между сезонными компонентами. Вы могли заметить, что форма суточных сезонных профилей в будни и выходные немного разная; явно моделировать этот эффект с помощью ARIMA не получится.
 </p>
 <p>
  Нам нужна более сложная модель. Давайте займёмся сведением задачи массового прогнозирования рядов к регрессионной постановке!
 </p>
 <p>
  Вам понадобится много признаков. Некоторые из них у вас уже есть — это:
 </p>
 <ul bullettype="bullets">
  <li>
   <p>
    идентификатор географической зоны
   </p>
  </li>
  <li>
   <p>
    дата и время
   </p>
  </li>
  <li>
   <p>
    количество поездок в периоды, предшествующие прогнозируемому
   </p>
  </li>
  <li>
   <p>
    синусы, косинусы и тренды, которые вы использовали внутри регрессионной компоненты ARIMA
   </p>
  </li>
 </ul>
 <p>
  Кроме того, не спешите выбрасывать построенный вами на прошлой неделе прогнозы — из них может получиться хороший признак для регрессии!
 </p>
 <p>
  Вы можете попробовать разные регрессионный модели, но хорошие результаты, скорее всего, дадут такие, которые будут позволять признакам взаимодействовать друг с другом.
 </p>
 <p hasmath="true">
  Поскольку прогноз нужен на 6 часов вперёд, проще всего будет построить 6 независимых регрессионных моделей — одна для прогнозирования \(\hat{y}_{T+1|T}\), другая для \(\hat{y}_{T+2|T}\) и т.д.
 </p>
 <p>
 </p>
 <p>
  Чтобы сдать задание, выполните следующую последовательность действий.
 </p>
 <ol bullettype="numbers">
  <li>
   <p hasmath="true">
    Для каждой из шести задач прогнозирования \(\hat{y}_{T+i|T}, i=1,\dots,6\) сформируйте выборки. Откликом будет \(y_{T+i}\) при всевозможных значениях \(T\), а признаки можно использовать следующие:
   </p>
  </li>
 </ol>
 <ul bullettype="bullets">
  <li>
   <p>
    идентификатор географической зоны — категориальный
   </p>
  </li>
  <li>
   <p>
    год, месяц, день месяца, день недели, час — эти признаки можно пробовать брать и категориальными, и непрерывными, можно даже и так, и так
   </p>
  </li>
  <li>
   <p>
    синусы, косинусы и тренды, которые вы использовали внутри регрессионной компоненты ARIMA
   </p>
  </li>
  <li>
   <p hasmath="true">
    сами значения прогнозов ARIMA \(\hat{y}_{T+i|T}^{ARIMA}\)
   </p>
  </li>
  <li>
   <p hasmath="true">
    количество поездок из рассматриваемого района в моменты времени \(y_T, y_{T-1}, \dots, y_{T-K}\) (параметр \(K\) можно подбирать; попробуйте начать, например, с 6)
   </p>
  </li>
  <li>
   <p hasmath="true">
    количество поездок из рассматриваемого района в моменты времени \(y_{T-24}, y_{T-48}, \dots, y_{T-24*K_d}\) (параметр \(K_d\) можно подбирать; попробуйте начать, например, с 2)
   </p>
  </li>
  <li>
   <p>
    суммарное количество поездок из рассматриваемого района за предшествующие полдня, сутки, неделю, месяц
   </p>
  </li>
 </ul>
 <p hasmath="true">
  Будьте внимательны при создании признаков — все факторы должны быть рассчитаны без использования информации из будущего: при прогнозировании \(\hat{y}_{T+i|T}, i=1,\dots,6\) вы можете учитывать только значения \(y\) до момента времени \(T\) включительно.
 </p>
 <p>
  2. Разбейте каждую из шести выборок на три части:
 </p>
 <ul bullettype="bullets">
  <li>
   <p>
    обучающая, на которой будут настраиваться параметры моделей — всё до апреля 2016
   </p>
  </li>
  <li>
   <p>
    тестовая, на которой вы будете подбирать значения гиперпараметров — май 2016
   </p>
  </li>
  <li>
   <p>
    итоговая, которая не будет использоваться при настройке моделей вообще — июнь 2016
   </p>
  </li>
 </ul>
 <p>
  3. Выберите вашу любимую регрессионную модель и настройте её на каждом из шести наборов данных, подбирая гиперпараметры на мае 2016. Желательно, чтобы модель:
 </p>
 <ul bullettype="bullets">
  <li>
   <p>
    допускала попарные взаимодействия между признаками
   </p>
  </li>
  <li>
   <p>
    была устойчивой к избыточному количеству признаков (например, использовала регуляризаторы)
   </p>
  </li>
 </ul>
 <p hasmath="true">
  4. Выбранными моделями постройте для каждой географической зоны и каждого конца истории от 2016.04.30 23:00 до 2016.05.31 17:00 прогнозы на 6 часов вперёд; посчитайте в ноутбуке ошибку прогноза по следующему функционалу: \[Q_{may} =\frac1{R * 739* 6} \sum\limits_{r=1}^{R}  \sum_{T=2016.04.30 23:00}^{2016.05.31 17:00} \sum_{i=1}^6 \left| \hat{y}^r_{T|T+i} - y^r_{T+i} \right|.\] Убедитесь, что ошибка полученных прогнозов, рассчитанная согласно функционалу \(Q\), определённому на прошлой неделе, уменьшилась по сравнению с той, которую вы получили методом индивидуального применения моделей ARIMA. Если этого не произошло, попробуйте улучшить ваши модели.
 </p>
 <p>
  5. Итоговыми моделями постройте прогнозы для каждого конца истории от 2016.05.31 23:00 до 2016.06.30 17:00 и запишите все результаты в один файл в формате
  <em>
   geoID, histEndDay, histEndHour, step, y.
  </em>
  Здесь geoID — идентификатор зоны, histEndDay — день конца истории в формате id,y, где столбец id состоит из склеенных через подчёркивание идентификатора географической зоны, даты конца истории, часа конца истории и номера отсчёта, на который делается предсказание (1-6); столбец y — ваш прогноз.
 </p>
 <p>
  6. Загрузите полученный файл на kaggle:
  <a href="https://inclass.kaggle.com/c/yellowtaxi">
   https://inclass.kaggle.com/c/yellowtaxi
  </a>
  . Добавьте в ноутбук ссылку на сабмишн.
 </p>
 <p>
  7. Загрузите ноутбук в форму.
 </p>
</co-content>
<h3 level="3">
 Review criteria
</h3>
<co-content>
 <p>
  В качестве ответа в этом задании вам нужно загрузить ноутбук; убедитесь, что ход анализа, который вы провели, описан достаточно подробно для того, чтобы ваши сокурсники поняли, что вы делали и почему.
 </p>
</co-content>
<style>
 body {
    padding: 50px 85px 50px 85px;
}

table th, table td {
    border: 1px solid #e0e0e0;
    padding: 5px 20px;
    text-align: left;
}
input {
    margin: 10px;
}
}
th {
    font-weight: bold;
}
td, th {
    display: table-cell;
    vertical-align: inherit;
}
img {
    height: auto;
    max-width: 100%;
}
pre {
    display: block;
    margin: 20px;
    background: #424242;
    color: #fff;
    font-size: 13px;
    white-space: pre-wrap;
    padding: 9.5px;
    margin: 0 0 10px;
    border: 1px solid #ccc;
}
</style>
<script async="" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
</script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$$','$$'], ['$','$'] ],
      displayMath: [ ["\\[","\\]"] ],
      processEscapes: true
    }
  });
</script>
